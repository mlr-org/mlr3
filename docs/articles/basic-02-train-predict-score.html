<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Google Site Verification --><meta name="google-site-verification" content="BrjL5fpoyHZu1rR8rwnnM2MBO3u3iIFB8NsmSuOsY84">
<title>Introduction to train/predict/score • mlr3</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Introduction to train/predict/score">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
<link rel="apple-touch-icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html"></a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-01-tasks.html">Tasks</a>
    </li>
    <li>
      <a href="../articles/basic-02-train-predict-score.html">Learners</a>
    </li>
    <li>
      <a href="../articles/basic-03-resample.html">Train</a>
    </li>
    <li>
      <a href="../articles/basic-04-parallelization.html">Predict</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Function Reference</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlr3">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fa fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fa fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-web.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to train/predict/score</h1>
                        <h4 class="author">Michel Lang</h4>
            
            <h4 class="date">2018-10-28</h4>
      
      <!--The 'toc' block was inserted manually by @pat-s. It triggeres the inline ToC in the vignettes.-->
            <div id="toc">
      <h3 class="hasAnchor">
<a href="#toc" class="anchor"></a>Table of Contents</h3>
      <ul>
<li><a href="#objects">Objects</a></li>
      <li><a href="#splitting-into-train-and-test">Splitting into train and test</a></li>
      <li><a href="#setting-up-an-experiment">Setting up an Experiment</a></li>
      <li><a href="#training">Training</a></li>
      <li><a href="#predicting">Predicting</a></li>
      <li><a href="#performance-assessment">Performance Assessment</a></li>
      <li><a href="#chaining-methods">Chaining methods</a></li>
      </ul>
</div>
      
      <small>Source: <a href="https://github.com/mlr-org/mlr3/blob/master/vignettes/basic-02-train-predict-score.Rmd"><code>vignettes/basic-02-train-predict-score.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p>In this introduction we simply fit a classification tree on the iris and determine the mean misclassification error.</p>
<div id="objects" class="section level2">
<h2 class="hasAnchor">
<a href="#objects" class="anchor"></a>Objects</h2>
<p>First, we need to generate retrieve the following <code>mlr3</code> objects from the task dictionary and the learner dictionary, respectively:</p>
<ol style="list-style-type: decimal">
<li>
<p>The classification task</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">"iris"</span>)</a></code></pre></div>
</li>
<li>
<p>A learner for the classification tree</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">learner =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw">get</span>(<span class="st">"classif.rpart"</span>)</a></code></pre></div>
</li>
</ol>
</div>
<div id="splitting-into-train-and-test" class="section level2">
<h2 class="hasAnchor">
<a href="#splitting-into-train-and-test" class="anchor"></a>Splitting into train and test</h2>
<p>We opt to learn on roughly <span class="math inline">\(\frac{4}{5}\)</span> of the observations and predict on the other <span class="math inline">\(\frac{1}{5}\)</span>. To do so we create two index vectors:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">train.set =<span class="st"> </span><span class="kw">sample</span>(task<span class="op">$</span>nrow, <span class="dv">4</span><span class="op">/</span><span class="dv">5</span> <span class="op">*</span><span class="st"> </span>task<span class="op">$</span>nrow)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">test.set =<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">seq_len</span>(task<span class="op">$</span>nrow), train.set)</a></code></pre></div>
</div>
<div id="setting-up-an-experiment" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-an-experiment" class="anchor"></a>Setting up an Experiment</h2>
<p>The process of fitting a machine learning model, predicting on test data and scoring the predictions by comparing predicted and true labels is called an experiment. For this reason, we start by initializing an experiment here, too:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">e =<span class="st"> </span>Experiment<span class="op">$</span><span class="kw">new</span>(<span class="dt">task =</span> task, <span class="dt">learner =</span> learner)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">print</span>(e)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; Experiment [incomplete]:</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;  + Task: iris</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;  + Learner: classif.rpart</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;  - Model: [missing]</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;  - Predictions: [missing]</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  - Performance: [missing]</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; Public: clone, data, has_errors, logs, model, performance,</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;   predict, prediction, score, state, test_set, timings, train,</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;   train_set, validation_set</span></a></code></pre></div>
<p>The printer also shows a summary of the state of the experiment.</p>
</div>
<div id="training" class="section level2">
<h2 class="hasAnchor">
<a href="#training" class="anchor"></a>Training</h2>
<p>To train the learner on the task, we call the train function of the experiment:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">e<span class="op">$</span><span class="kw">train</span>(<span class="dt">subset =</span> train.set)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; Training learner 'classif.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">print</span>(e)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; Experiment [incomplete]:</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;  + Task: iris</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;  + Learner: classif.rpart</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  + Model: [rpart]</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  - Predictions: [missing]</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  - Performance: [missing]</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; Public: clone, data, has_errors, logs, model, performance,</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;   predict, prediction, score, state, test_set, timings, train,</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;   train_set, validation_set</span></a></code></pre></div>
<p>The printer indicates that the object was grown, we have now stored a model in the experiment (along some more technical stuff like log files):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">rpart.model =<span class="st"> </span>e<span class="op">$</span>model</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">print</span>(rpart.model)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; n= 120 </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; node), split, n, loss, yval, (yprob)</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;       * denotes terminal node</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; 1) root 120 78 setosa (0.35000000 0.34166667 0.30833333)  </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;   2) Petal.Length&lt; 2.6 42  0 setosa (1.00000000 0.00000000 0.00000000) *</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;   3) Petal.Length&gt;=2.6 78 37 versicolor (0.00000000 0.52564103 0.47435897)  </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;     6) Petal.Width&lt; 1.75 44  4 versicolor (0.00000000 0.90909091 0.09090909) *</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;     7) Petal.Width&gt;=1.75 34  1 virginica (0.00000000 0.02941176 0.97058824) *</span></a></code></pre></div>
</div>
<div id="predicting" class="section level2">
<h2 class="hasAnchor">
<a href="#predicting" class="anchor"></a>Predicting</h2>
<p>After the training step, we are able to use the experiment to predict on observations of the task (note that you may alternatively also pass new data here as <code>data.frame</code>):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">e<span class="op">$</span><span class="kw">predict</span>(<span class="dt">subset =</span> test.set)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; Predicting model of learner 'classif.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">print</span>(e)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; Experiment [incomplete]:</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  + Task: iris</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  + Learner: classif.rpart</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  + Model: [rpart]</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  + Predictions: [PredictionClassif]</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  - Performance: [missing]</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; Public: clone, data, has_errors, logs, model, performance,</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;   predict, prediction, score, state, test_set, timings, train,</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;   train_set, validation_set</span></a></code></pre></div>
<p>The predictions can be retrieved as a simple <code>data.table</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">head</span>(e<span class="op">$</span>prediction)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;    id  truth response</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; 1:  2 setosa   setosa</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; 2:  4 setosa   setosa</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; 3: 10 setosa   setosa</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; 4: 21 setosa   setosa</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; 5: 22 setosa   setosa</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; 6: 31 setosa   setosa</span></a></code></pre></div>
</div>
<div id="performance-assessment" class="section level2">
<h2 class="hasAnchor">
<a href="#performance-assessment" class="anchor"></a>Performance Assessment</h2>
<p>The last step of the experiment is quantifying the predicted labels by comparing them with the true labels using a performance measure. The default measure for the iris classification task is the mean misclassification error which is used here automatically:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/ids.html">ids</a></span>(task<span class="op">$</span>measures)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; [1] "mmce"</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">e<span class="op">$</span><span class="kw">score</span>()</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; Scoring predictions of learner 'classif.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">print</span>(e)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; Experiment [complete]:</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;  + Task: iris</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt;  + Learner: classif.rpart</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;  + Model: [rpart]</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;  + Predictions: [PredictionClassif]</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;  + Performance: mmce=0.0333333</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; Public: clone, data, has_errors, logs, model, performance,</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;   predict, prediction, score, state, test_set, timings, train,</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;   train_set, validation_set</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">e<span class="op">$</span>performance[<span class="st">"mmce"</span>]</a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt;       mmce </span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; 0.03333333</span></a></code></pre></div>
<p>The experiment is now “complete” which means we can access all of its methods.</p>
</div>
<div id="chaining-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#chaining-methods" class="anchor"></a>Chaining methods</h2>
<p>Instead of calling the methods <code>$train()</code>, <code>$predict()</code> and <code>$score()</code> one after each other, it is also possible to chain these commands:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">Experiment<span class="op">$</span><span class="kw">new</span>(<span class="dt">task =</span> task, <span class="dt">learner =</span> learner)<span class="op">$</span><span class="kw">train</span>(train.set)<span class="op">$</span><span class="kw">predict</span>(test.set)<span class="op">$</span><span class="kw">score</span>()</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; Training learner 'classif.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; Predicting model of learner 'classif.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; Scoring predictions of learner 'classif.rpart' on task 'iris' ...</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#objects">Objects</a></li>
      <li><a href="#splitting-into-train-and-test">Splitting into train and test</a></li>
      <li><a href="#setting-up-an-experiment">Setting up an Experiment</a></li>
      <li><a href="#training">Training</a></li>
      <li><a href="#predicting">Predicting</a></li>
      <li><a href="#performance-assessment">Performance Assessment</a></li>
      <li><a href="#chaining-methods">Chaining methods</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><!--<div class="copyright">
  <p>Developed by Bernd Bischl, Michel Lang, Jakob Richter.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>
--></footer>
</div>

   

  </body>
</html>
