<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Google Site Verification --><meta name="google-site-verification" content="BrjL5fpoyHZu1rR8rwnnM2MBO3u3iIFB8NsmSuOsY84">
<title>Handling model errors â€¢ mlr3</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Handling model errors">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
<link rel="apple-touch-icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html"></a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-01-tasks.html">Tasks</a>
    </li>
    <li>
      <a href="../articles/basic-02-train-predict-score.html">Train, predict, score</a>
    </li>
    <li>
      <a href="../articles/basic-03-resample.html">Resampling</a>
    </li>
    <li>
      <a href="../articles/basic-04-parallelization.html">Parallelization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Function Reference</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlr3">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fa fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fa fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-web.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Handling model errors</h1>
                        <h4 class="author">Michel Lang</h4>
            
      
      <!--The 'toc' block was inserted manually by @pat-s. It triggeres the inline ToC in the vignettes.-->
            <div id="toc">
      <h3 class="hasAnchor">
<a href="#toc" class="anchor"></a>Table of Contents</h3>
      <ul>
<li><a href="#setup">Setup</a></li>
      <li><a href="#no-error-handling">No Error Handling</a></li>
      <li><a href="#fallback-learners">Fallback Learners</a></li>
      </ul>
</div>
      
      <small>Source: <a href="https://github.com/mlr-org/mlr3/blob/master/vignettes/basic-05-error-handling.Rmd"><code>vignettes/basic-05-error-handling.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p>This vignettes demonstrates how to deal with learners which raise exceptions during train or predict.</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>First, we need a simple learning task and a learner which raises exceptions. For this purpose, <code>mlr3</code> ships with the learner <code>classif.crashtest</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="st">"spam"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">learner =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="st">"classif.crashtest"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(learner)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Learner 'classif.crashtest' for classif</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; Parameters: crash.on=train, crash.mode=error</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; Feature types: logical,integer,numeric,character,factor,ordered</span></a></code></pre></div>
<p>The hyperparameters let us control (a) whether it should crash during train or predict, and (b) if the learner should crash with an error or segfault (which tears down the complete R session).</p>
</div>
<div id="no-error-handling" class="section level1">
<h1 class="hasAnchor">
<a href="#no-error-handling" class="anchor"></a>No Error Handling</h1>
<p>In the defaults, <code>mlr3</code> does not handle model errors specially. Thus, the exception raised by the crashtest learner can stops the execution and can be tracebacked:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">e =<span class="st"> </span>Experiment<span class="op">$</span><span class="kw">new</span>(task, learner)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">e<span class="op">$</span><span class="kw">train</span>()</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Error in (function (task, crash.on, crash.mode, ...) : Error in classif.crashtest during train()</span></a></code></pre></div>
<p>The traceback might be obfuscated by the parallelization framework, depending on your configuration and installation. To get a better traceback, we turn the parallelization completely off:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/mlr_control.html">mlr_control</a></span>(<span class="dt">use_future =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">e<span class="op">$</span><span class="kw">train</span>(<span class="dt">ctrl =</span> ctrl)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; Training learner 'classif.crashtest' on task 'spam' ...</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; Error in (function (task, crash.on, crash.mode, ...) : Error in classif.crashtest during train()</span></a></code></pre></div>
<p>During parallelization, error messages (as well as normal output or warnings) are often not properly forwarded to the master R session, or they arrive in a confusing order. The learner execution can be encapsulated, so its output is logged to the experiment instead of just printed to the console.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/mlr_control.html">mlr_control</a></span>(<span class="dt">use_evaluate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">e =<span class="st"> </span>Experiment<span class="op">$</span><span class="kw">new</span>(task, learner)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">e<span class="op">$</span><span class="kw">train</span>(<span class="dt">ctrl =</span> ctrl)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">e<span class="op">$</span>has_errors</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">e<span class="op">$</span>logs<span class="op">$</span>train</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; &lt;Log&gt; with 1 message:</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 1: [error] Error in classif.crashtest during train()</span></a></code></pre></div>
<p>Note that, although no exception has been raised, it is impossible to perform the predict step without a model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">e<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>()</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; Error in (function (e, ctrl) : Unable to predict learner 'classif.crashtest' without model</span></a></code></pre></div>
</div>
<div id="fallback-learners" class="section level1">
<h1 class="hasAnchor">
<a href="#fallback-learners" class="anchor"></a>Fallback Learners</h1>
<p>Each learner can have a fallback learner, which is used if either the train or predict step fail. Here, we simply fallback to the predictions of a featureless learner (predicting majority class):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="st">"spam"</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">learner =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="st">"classif.crashtest"</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">learner<span class="op">$</span>fallback =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="st">"classif.featureless"</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/mlr_control.html">mlr_control</a></span>(<span class="dt">use_evaluate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">e =<span class="st"> </span>Experiment<span class="op">$</span><span class="kw">new</span>(<span class="dt">task =</span> task, <span class="dt">learner =</span> learner)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">e<span class="op">$</span><span class="kw">train</span>(<span class="dt">ctrl =</span> ctrl)</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">e<span class="op">$</span>prediction</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; &lt;PredictionClassif&gt; for 4601 observations:</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt;       row_id response   truth</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;    1:      1  nonspam    spam</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt;    2:      2  nonspam    spam</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt;    3:      3  nonspam    spam</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt;   ---                        </span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt; 4599:   4599  nonspam nonspam</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt; 4600:   4600  nonspam nonspam</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt; 4601:   4601  nonspam nonspam</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">e<span class="op">$</span>performance</a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="co">#&gt;      mmce </span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="co">#&gt; 0.3940448</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27">e<span class="op">$</span>logs</a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="co">#&gt; $train</span></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="co">#&gt; &lt;Log&gt; with 1 message:</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="co">#&gt; 1: [error] Error in classif.crashtest during train()</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="co">#&gt; $predict</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="co">#&gt; &lt;Log&gt; with 0 messages:</span></a></code></pre></div>
<p>Note that the logs and timings are tracked for the original learner, not the fallback learner.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#no-error-handling">No Error Handling</a></li>
      <li><a href="#fallback-learners">Fallback Learners</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><!--<div class="copyright">
  <p>Developed by Bernd Bischl, Michel Lang, Jakob Richter.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>
--></footer>
</div>

   

  </body>
</html>
