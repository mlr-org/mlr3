<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create Evaluation Callback — callback_resample • mlr3</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create Evaluation Callback — callback_resample"><meta name="description" content="Function to create a CallbackResample.
Predefined callbacks are stored in the dictionary mlr_callbacks and can be retrieved with clbk().
Evaluation callbacks are called at different stages of the resampling process.
Each stage is called once per resampling iteration.
The stages are prefixed with on_resample_*.
The text in brackets indicates what happens between the stages in the internal workhorse() function and which accesses to the ContextResample (ctx) are typical for the stage.
Start Resampling Iteration on Worker
 - on_resample_begin
   (Split `ctx$task` into training and test set with `ctx$resampling` and `ctx$iteration`)
 - on_resample_before_train
   (Train the learner `ctx$learner` on training data)
 - on_resample_before_predict
   (Predict on predict sets and store prediction data `ctx$pdatas`)
 - on_resample_end
   (Erase model `ctx$learner$model` if requested and return results)
End Resampling Iteration on Worker

The callback can store data in ctx$learner$state or ctx$data_extra.
The data in ctx$data_extra is stored in the ResampleResult or BenchmarkResult.
See also the section on parameters for more information on the stages."><meta property="og:description" content="Function to create a CallbackResample.
Predefined callbacks are stored in the dictionary mlr_callbacks and can be retrieved with clbk().
Evaluation callbacks are called at different stages of the resampling process.
Each stage is called once per resampling iteration.
The stages are prefixed with on_resample_*.
The text in brackets indicates what happens between the stages in the internal workhorse() function and which accesses to the ContextResample (ctx) are typical for the stage.
Start Resampling Iteration on Worker
 - on_resample_begin
   (Split `ctx$task` into training and test set with `ctx$resampling` and `ctx$iteration`)
 - on_resample_before_train
   (Train the learner `ctx$learner` on training data)
 - on_resample_before_predict
   (Predict on predict sets and store prediction data `ctx$pdatas`)
 - on_resample_end
   (Erase model `ctx$learner$model` if requested and return results)
End Resampling Iteration on Worker

The callback can store data in ctx$learner$state or ctx$data_extra.
The data in ctx$data_extra is stored in the ResampleResult or BenchmarkResult.
See also the section on parameters for more information on the stages."><meta property="og:image" content="https://mlr3.mlr-org.com/logo.svg"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mlr3</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-alt"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr3book.mlr-org.com"><span class="fa fa-link"></span> mlr3book</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/mlr3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/"><span class="fa fa-comments"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr3"><span class="fa fab fa-stack-overflow"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr-org.com/"><span class="fa fa-rss"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Create Evaluation Callback</h1>
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3/blob/main/R/CallbackResample.R" class="external-link"><code>R/CallbackResample.R</code></a></small>
      <div class="d-none name"><code>callback_resample.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to create a <a href="CallbackResample.html">CallbackResample</a>.
Predefined callbacks are stored in the <a href="https://mlr3misc.mlr-org.com/reference/Dictionary.html" class="external-link">dictionary</a> <a href="https://mlr3misc.mlr-org.com/reference/mlr_callbacks.html" class="external-link">mlr_callbacks</a> and can be retrieved with <code><a href="https://mlr3misc.mlr-org.com/reference/clbk.html" class="external-link">clbk()</a></code>.</p>
<p>Evaluation callbacks are called at different stages of the resampling process.
Each stage is called once per resampling iteration.
The stages are prefixed with <code>on_resample_*</code>.
The text in brackets indicates what happens between the stages in the internal <code>workhorse()</code> function and which accesses to the <a href="ContextResample.html">ContextResample</a> (<code>ctx</code>) are typical for the stage.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>Start Resampling Iteration on Worker</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a> <span class="sc">-</span> on_resample_begin</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>   (Split <span class="st">`</span><span class="at">ctx$task</span><span class="st">`</span> into training and test set with <span class="st">`</span><span class="at">ctx$resampling</span><span class="st">`</span> and <span class="st">`</span><span class="at">ctx$iteration</span><span class="st">`</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> <span class="sc">-</span> on_resample_before_train</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>   (Train the learner <span class="st">`</span><span class="at">ctx$learner</span><span class="st">`</span> on training data)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a> <span class="sc">-</span> on_resample_before_predict</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>   (Predict on predict sets and store prediction data <span class="st">`</span><span class="at">ctx$pdatas</span><span class="st">`</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a> <span class="sc">-</span> on_resample_end</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>   (Erase model <span class="st">`</span><span class="at">ctx$learner$model</span><span class="st">`</span> <span class="cf">if</span> requested and return results)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>End Resampling Iteration on Worker</span></code></pre><p></p></div>
<p>The callback can store data in <code>ctx$learner$state</code> or <code>ctx$data_extra</code>.
The data in <code>ctx$data_extra</code> is stored in the <a href="ResampleResult.html">ResampleResult</a> or <a href="BenchmarkResult.html">BenchmarkResult</a>.
See also the section on parameters for more information on the stages.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">callback_resample</span><span class="op">(</span></span>
<span>  <span class="va">id</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  man <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  on_resample_begin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_resample_before_train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_resample_before_predict <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_resample_end <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>(<code>character(1)</code>)<br>
Identifier for the new instance.</p></dd>


<dt id="arg-label">label<a class="anchor" aria-label="anchor" href="#arg-label"></a></dt>
<dd><p>(<code>character(1)</code>)<br>
Label for the new instance.</p></dd>


<dt id="arg-man">man<a class="anchor" aria-label="anchor" href="#arg-man"></a></dt>
<dd><p>(<code>character(1)</code>)<br>
String in the format <code>[pkg]::[topic]</code> pointing to a manual page for this object.
The referenced help package can be opened via method <code>$help()</code>.</p></dd>


<dt id="arg-on-resample-begin">on_resample_begin<a class="anchor" aria-label="anchor" href="#arg-on-resample-begin"></a></dt>
<dd><p>(<code>function()</code>)<br>
Stage called at the beginning of an evaluation.
Called in <code>workhorse()</code> (internal).</p></dd>


<dt id="arg-on-resample-before-train">on_resample_before_train<a class="anchor" aria-label="anchor" href="#arg-on-resample-before-train"></a></dt>
<dd><p>(<code>function()</code>)<br>
Stage called before training the learner.
Called in <code>workhorse()</code> (internal).</p></dd>


<dt id="arg-on-resample-before-predict">on_resample_before_predict<a class="anchor" aria-label="anchor" href="#arg-on-resample-before-predict"></a></dt>
<dd><p>(<code>function()</code>)<br>
Stage called before predicting.
Called in <code>workhorse()</code> (internal).</p></dd>


<dt id="arg-on-resample-end">on_resample_end<a class="anchor" aria-label="anchor" href="#arg-on-resample-end"></a></dt>
<dd><p>(<code>function()</code>)<br>
Stage called at the end of an evaluation.
Called in <code>workhorse()</code> (internal).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When implementing a callback, each function must have two arguments named <code>callback</code> and <code>context</code>.
A callback can write data to the state (<code>$state</code>), e.g. settings that affect the callback itself.
We highly discourage changing the task, learner and resampling objects via the callback.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"pima"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># save selected features callback</span></span></span>
<span class="r-in"><span><span class="va">callback</span> <span class="op">=</span> <span class="fu">callback_resample</span><span class="op">(</span><span class="st">"selected_features"</span>,</span></span>
<span class="r-in"><span> on_resample_end <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">callback</span>, <span class="va">context</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">context</span><span class="op">$</span><span class="va">learner</span><span class="op">$</span><span class="va">state</span><span class="op">$</span><span class="va">selected_features</span> <span class="op">=</span> <span class="va">context</span><span class="op">$</span><span class="va">learner</span><span class="op">$</span><span class="fu">selected_features</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rr</span> <span class="op">=</span> <span class="fu"><a href="resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">resampling</span>, callbacks <span class="op">=</span> <span class="va">callback</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rr</span><span class="op">$</span><span class="va">learners</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">state</span><span class="op">$</span><span class="va">selected_features</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "glucose"  "age"      "mass"     "pedigree" "pressure"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># holdout task callback</span></span></span>
<span class="r-in"><span><span class="va">callback</span> <span class="op">=</span> <span class="fu">callback_resample</span><span class="op">(</span><span class="st">"holdout_task"</span>,</span></span>
<span class="r-in"><span>  on_resample_before_predict <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">callback</span>, <span class="va">context</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">pred</span> <span class="op">=</span> <span class="va">context</span><span class="op">$</span><span class="va">learner</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">callback</span><span class="op">$</span><span class="va">state</span><span class="op">$</span><span class="va">task</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">context</span><span class="op">$</span><span class="va">data_extra</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prediction_holdout <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">task_holdout</span> <span class="op">=</span> <span class="fu"><a href="mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"pima"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">splits</span> <span class="op">=</span> <span class="fu"><a href="partition.html">partition</a></span><span class="op">(</span><span class="va">task</span>, <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">task</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">task_holdout</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">callback</span><span class="op">$</span><span class="va">state</span><span class="op">$</span><span class="va">task</span> <span class="op">=</span> <span class="va">task_holdout</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rr</span> <span class="op">=</span> <span class="fu"><a href="resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">resampling</span>, callbacks <span class="op">=</span> <span class="va">callback</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rr</span><span class="op">$</span><span class="va">data_extra</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;uhash, iteration&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                   uhash iteration data_extra</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                  &lt;char&gt;     &lt;int&gt;     &lt;list&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 58767b0b-9de2-4c07-9771-ab4ea3ca051d         1  &lt;list[1]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: 58767b0b-9de2-4c07-9771-ab4ea3ca051d         2  &lt;list[1]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: 58767b0b-9de2-4c07-9771-ab4ea3ca051d         3  &lt;list[1]&gt;</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Lang, Bernd Bischl, Jakob Richter, Patrick Schratz, Martin Binder, Florian Pfisterer, Raphael Sonabend, Marc Becker, Sebastian Fischer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

