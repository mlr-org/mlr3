#' @include Resampling.R
ResamplingCustom = R6Class("ResamplingCustom", inherit = Resampling,
  public = list(
    initialize = function(id = "custom") {
      super$initialize(id = id)
    },

    instantiate = function(task, train_sets = NULL, test_sets = NULL) {
      assert_task(task)

      if (!is.null(train_sets)) {
        # TODO: more assertions
        assert_list(train_sets, types = "atomicvector", any.missing = FALSE)
        private$.instance = list(train = train_sets, test = NULL)
        private$.hash = NA_character_
        self$has_duplicates = any(viapply(train_sets, anyDuplicated) > 0L)
      }

      if (!is.null(test_sets)) {
        # TODO: more assertions
        train = private$.instance$train
        if (is.null(train))
          stopf("Cannot set test_set without training set")
        assert_list(test_sets, types = "atomicvector", len = length(train), any.missing = FALSE)
        private$.instance$test = test_sets
        private$.hash = NA_character_
        self$has_duplicates = isTRUE(self$has_duplicates) | any(viapply(test_sets, anyDuplicated) > 0L)
      }

      self
    },

    train_set = function(i) {
      i = assert_resampling_index(self, i)
      private$.instance$train[[i]]
    },

    test_set = function(i) {
      i = assert_resampling_index(self, i)
      private$.instance$test[[i]]
    }
  ),

  active = list(
    iters = function() {
      length(private$.instance$train)
    }
  )
)
